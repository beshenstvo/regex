<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <title>Тестовое</title>
    <style>
      .invalidInput { border: solid 1px red; }
      .error { display: block; color: red; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card text-dark bg-light mb-3" style="max-width: 40rem; margin: 40px auto;">
            <div class="card-header">Регистрация пользователя</div>
            <div class="card-body">
              <form class="row g-3">
                <div class="col-md-12">
                  <label for="email" class="form-label">Email</label>
                  <input type="text" class="form-control" id="email" placeholder="xxx@xxx.xxx" pattern="[a-zA-Z0-9]{3,}@[a-zA-Z0-9]{3,}\.[a-zA-Z0-9]{2,}" required> <!--Пункт - 1 d-->
                  <div id="invalidCheckEmail1" class="error"></div>
                  <div id="invalidCheckEmail2" class="error"></div>
                </div>
                <div class="col-md-6">
                  <label for="name" class="form-label">Имя</label>
                  <input type="text" class="form-control" id="name" placeholder="Руфина" >
                  <div id="invalidCheckName1" class='error'></div>
                  <div id="invalidCheckName2" class='error'></div>
                </div>
                <div class="col-6">
                  <label for="lastname" class="form-label">Фамилия</label>
                  <input type="text" class="form-control" id="lastname" placeholder="Гатауллина" >
                  <div id="invalidCheckLastname1" class='error'></div>
                  <div id="invalidCheckLastname2" class='error'></div>
                </div>
                <div class="col-12">
                  <label for="password" class="form-label">Пароль</label>
                  <input type="password" class="form-control" id="password" placeholder="********" required>
                  <div id="invalidCheckPassword1" class='error'></div>
                  <div id="invalidCheckPassword2" class='error'></div>
                </div>
                <div class="col-md-12">
                  <label for="passwordTwo" class="form-label">Подтверждение пароля</label>
                  <input type="password" class="form-control" id="passwordTwo" placeholder="********" required disabled>
                  <div id="invalidCheckPasswordTwo1" class='error'></div>
                  <div id="invalidCheckPasswordTwo2" class='error'></div>
                </div>
                <div class="col-12">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="gridCheck" onclick="removeError()">
                    <label class="form-check-label" for="gridCheck" >
                      Принимаю условия лицензионного соглашения
                    </label>
                    <div id="invalidCheckGridCheck" class='error'></div>
                  </div>
                </div>
                <div class="col-12">
                  <div id="invalidMain" class='error'></div>
                  <button type="button" class="btn btn-primary" onclick="check()">Регистрация</button>
                </div>
              </form>
            </div>
          </div>
    </div>

<script>
//проверка Email 
document.getElementById('email').onblur = function() { //когда фокус убираем 
  if( !this.value.match(/[a-zA-Z0-9_.-]{3,}@[a-zA-Z0-9]{3,}\.[a-zA-Z]{2,}/gm)) { 
    this.classList.add('invalidInput')
    invalidCheckEmail1.innerHTML = '* Необходимо заполнить поле в формате xxx@xxx.xxx'
  }
  if(document.getElementById('email').value.replace(/\s/g, '').length > 128) { 
    this.classList.add('invalidInput')
    invalidCheckEmail2.innerHTML = ' * Размер поля ограничен 128 символами.'
    }
}
document.getElementById('email').onfocus = function() { //при фокусе 
    this.classList.remove('invalidInput');
    invalidCheckEmail1.innerHTML = ''
    invalidCheckEmail2.innerHTML = ''
}

//проверка имени
document.getElementById('name').onblur = function() { 
  if( this.value.match(/[№";.,:`±!@#$%^&*()_+<>?\/\{}[\]]+|[0-9]+/gm)) { 
    this.classList.add('invalidInput')
    invalidCheckName1.innerHTML = '* Поле заполнено некорректно. Нельзя использовать спецсимволы'
  }
  if(document.getElementById('name').value.replace(/\s/g, '').length > 128) { 
    this.classList.add('invalidInput')
    invalidCheckName2.innerHTML = ' * Размер поля ограничен 128 символами.'
  }
}
document.getElementById('name').onfocus = function() { 
  this.classList.remove('invalidInput');
  invalidCheckName1.innerHTML = ''
  invalidCheckName2.innerHTML = ''
}

//проверка фамилии 
document.getElementById('lastname').onblur = function() { 
  if( this.value.match(/[№";.,:`±!@#$%^&*()_+<>?\/\{}[\]]+|[0-9]+/gm)) { 
    this.classList.add('invalidInput')
    invalidCheckLastname1.innerHTML = '* Поле заполнено некорректно. Нельзя использовать спецсимволы'
  }
  if(document.getElementById('lastname').value.replace(/\s/g, '').length > 128) { 
    this.classList.add('invalidInput')
    invalidCheckLastname2.innerHTML = ' * Размер поля ограничен 128 символами.'
  }
}
document.getElementById('lastname').onfocus = function() { 
  this.classList.remove('invalidInput');
  invalidCheckLastname1.innerHTML = ''
  invalidCheckLastname2.innerHTML = ''
}

//проверка пароля первое поле
document.getElementById('password').onblur = function() { 
  if(this.value.match(/\s/gm)) {
    this.classList.add('invalidInput')
    invalidCheckPassword1.innerHTML = ' * В пароле не должны содержаться пробелы.'
  }else if((this.value.length <= 8) || (!this.value.match(/\W+/g)) || (!this.value.match(/[0-9]+/g))) { 
    this.classList.add('invalidInput')
    invalidCheckPassword2.innerHTML = ' * Пароль должен содержать не менее 8 символов и должен содержать хотя бы один спецсимвол и цифру'
  }else{
    console.log('правильный пароль')
    document.getElementById("passwordTwo").removeAttribute("disabled");
    //выключить disabled
  }
}
document.getElementById('password').onfocus = function() { 
  this.classList.remove('invalidInput');
  invalidCheckPassword1.innerHTML = ''
  invalidCheckPassword2.innerHTML = ''
  document.getElementById("passwordTwo").setAttribute("disabled", 'disabled');
  //включить disabled
}

//проверка пароля второе поле
document.getElementById('passwordTwo').onblur = function() { 
  if(this.value != document.getElementById('password').value) {
    this.classList.add('invalidInput')
    invalidCheckPasswordTwo1.innerHTML = ' * Пароли должны совпадать.'
  }
}
document.getElementById('passwordTwo').onfocus = function() { 
  this.classList.remove('invalidInput');
  invalidCheckPasswordTwo1.innerHTML = ''
  invalidCheckPasswordTwo2.innerHTML = ''
}

//remove gridCheck
function removeError() { 
  invalidCheckGridCheck.innerHTML = '';
}

function check() { //конечная проверка всех полей
  invalidMain.innerHTML = 'Некорректно заполнены поля: ';
  if(!document.getElementById('gridCheck').checked) {
    invalidCheckGridCheck.innerHTML = ' * Для регистрации необходимо ознакомиться с лицензионным соглашением и принять его.'
  }
  if((!document.getElementById("email").value.match(/[a-zA-Z0-9_.-]{3,}@[a-zA-Z0-9]{3,}\.[a-zA-Z]{2,}/gm))){ // email
    invalidMain.innerHTML += 'email';
    email.classList.add('invalidInput')
    invalidCheckEmail1.innerHTML = '* Необходимо заполнить поле в формате xxx@xxx.xxx'
  }
  if((document.getElementById('password').value.length <= 8) || (!document.getElementById('password').value.match(/\W+/g)) || (!document.getElementById('password').value.match(/[0-9]+/g)) ){
    invalidMain.innerHTML += ' пароль'
    password.classList.add('invalidInput')
    invalidCheckPassword2.innerHTML = ' * Пароль должен содержать не менее 8 символов и должен содержать хотя бы один спецсимвол и цифру'
  }else if((document.getElementById('password').value != document.getElementById('passwordTwo').value)){
    invalidMain.innerHTML += ' пароль'
    passwordTwo.classList.add('invalidInput')
    invalidCheckPasswordTwo1.innerHTML = ' * Пароли должны совпадать.'
  }else{
    window.location.href = './home.html';
  }
  
}
    </script>
</body>
</html>